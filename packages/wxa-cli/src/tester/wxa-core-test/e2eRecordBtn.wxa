<template>
    <view>
        <button class="e2e-startRecord" style="top: {{top}}px; left: {{left}}px;" catchtap="tap" bindtouchstart="touchstart" catchtouchmove="touchmove" bindtouchend="touchend" catchtouchcancel="touchend">{{btnText}}</button>
    </view>
</template>

<script>

import {wxa, Throttle, Debounce} from '@wxa/core';
class e2eBtn {
    properties = {
    }
    data = {
        top: 1,
        left: 1,
        diffX: 0,
        diffY: 0,
        btnText: '开始录制'
    }
    tap() {
        let btnText = '开始录制';
        this.$$e2e_state.recording = !this.$$e2e_state.recording;
        if (this.$$e2e_state.recording) {
             btnText = '结束录制';
        }
         this.setData({
            btnText
        });

    }
    touchstart(e) {
        this.setData({
            diffX: e.touches[0].pageX - e.currentTarget.offsetLeft,
            diffY: e.touches[0].pageY - e.currentTarget.offsetTop
        })
    }
    handleMinMax(num, min, max) {
        return num < min ? min : (num > max ? max : num);
    }
    @Throttle(100)
    touchmove(e) {
        let systemInfo = wx.getSystemInfoSync();
        let minLeft = -this.data.diffX;
        let minTop = -this.data.diffY;
        let maxLeft = systemInfo.windowWidth - this.data.diffX;
        let maxTop = systemInfo.windowHeight - this.data.diffY;
        let top = e.touches[0].pageY - this.data.diffY;
        let left = e.touches[0].pageX - this.data.diffX;
        this.setData({
            left: this.handleMinMax(left, minLeft, maxLeft),
            top: this.handleMinMax(top, minTop, maxTop)
        })
    }
    touchend() {

    }
}

wxa.launchComponent(e2eBtn);
</script>
<config>
{
    "component": true
}
</config>
<style lang="scss">
.e2e-startRecord{
    position: fixed;
    width: 200rpx;
    left: 0;
    z-index: 100;
}
</style>
